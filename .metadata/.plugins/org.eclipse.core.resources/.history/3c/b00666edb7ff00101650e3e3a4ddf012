// Where the LD is Connected
// Port C
// pin 13

#include <stdint.h>

// PERIPHIRAL BASE ADDR
#define PERIPH_BASE 			(0x40000000UL)

// APB2 CLOCK BASE ADDR
#define APB2PERIPH_OFFSET 		(0x00010000UL)
#define APB2PERIPH_BASE 		(PERIPH_BASE + APB2PERIPH_OFFSET)

// PORT C BASE ADDR
#define GPIOC_OFFSET			(0x00001000UL)
#define GPIOC_BASE				(APB2PERIPH_BASE + GPIOC_OFFSET)

// AHBP CLOCK BASE ADDR
#define AHBPERIPH_OFFSET		(0x00018000UL)
#define AHBPERIPH_BASE			(PERIPH_BASE + AHBPERIPH_OFFSET)

// RCC BASE ADDR
#define RCC_OFFSET				(0x0009000UL)
#define RCC_BASE				(AHBPERIPH_BASE + RCC_OFFSET)

// APB2 Enable Register Base ADDR
#define RCC_APB2EN_R_OFFSET 	(0x18UL)
#define RCC_APB2EN_R 			(*(volatile unsigned int *)(RCC_BASE + RCC_APB2EN_R_OFFSET))

// PORT C GPIO CRH Register BASE ADDR
#define GPIOx_CRH_R_OFFSET		(0x04UL)
#define GPIOx_CRH_R				(*(volatile unsigned int *)(GPIOC_BASE + GPIOx_CRH_R_OFFSET)) // GPIO Mode Register

// PORT C GPIO Output Direction Register Base ADDR
#define GPIOx_OD_R_OFFSET		(0x0C)
#define GPIOx_OD_R				(*(volatile unsigned int *)(GPIOC_BASE + GPIOx_OD_R_OFFSET))

#define IOPCEN					(1U<<4)
#define PIN13					(1<<13)

#define LED_PIN					PIN13

typedef struct{
	volatile uint32_t RCC_CR;
	volatile uint32_t RCC_CFGR;
	volatile uint32_t RCC_CIR;
	volatile uint32_t RCC_APB2RSTR;
	volatile uint32_t RCC_APB1RSTR;
	volatile uint32_t RCC_AHBENR;
	volatile uint32_t RCC_APB2ENR;
	volatile uint32_t RCC_APB1ENR;
	volatile uint32_t RCC_BDCR;
	volatile uint32_t RCC_CSR;
	volatile uint32_t RCC_AHBSTR;
	volatile uint32_t RCC_CFGR2;
}RCC_TypeDef;


typedef struct{
	volatile uint32_t  GPIOx_CRL;
	volatile uint32_t  GPIOx_CRH;
	volatile uint32_t  GPIOx_IDR;
	volatile uint32_t  GPIOx_ODR;
	volatile uint32_t  GPIOx_BSRR;
	volatile uint32_t  GPIOx_BRR;
	volatile uint32_t  GPIOx_LCKR;
}GPIO_TypeDef;

#define RCC 		((RCC_TypeDef*) RCC_BASE)
#define GPIOC 		((GPIO_TypeDef*) GPIOC_BASE)


int main(void){
	// Enable clock  access to GPIOC
	RCC->RCC_APB2ENR |= IOPCEN;
	//RCC_APB2EN_R |= IOPCEN;
	// Set PC13 as output max speed 10MHz
	GPIOx_CRH_R |= (1<<20);
	GPIOx_CRH_R &= ~(1<<21);
	// Set PC13 as output open drain
	GPIOx_CRH_R |= (1<<22);
	GPIOx_CRH_R &= ~(1<<23);
	while(1){
		// Set PC13 High
		GPIOx_OD_R |= LED_PIN;
		for (volatile int i = 0; i < 500000; i++) {
		    // Corps de la boucle (code à répéter)
		}
		GPIOx_OD_R &= ~LED_PIN;

		for (volatile int i = 0; i < 500000; i++) {
				    // Corps de la boucle (code à répéter)
				}
	}
}










